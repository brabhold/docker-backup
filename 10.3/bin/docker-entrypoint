#!/usr/bin/env bash
set -e

if [ $1 = "cron" ]; then

    if [ -z "$SCHEDULE" ]; then
        echo Missing SCHEDULE environment variable 2>&1
        echo 'Example -e SCHEDULE="*/10 * * * * *"' 2>&1
        exit 1
    fi

    mkdir -p ${BACKUP_DIR}
    printenv | sed 's/^\(.*\)$/export \1/g' > /root/.mariadb-backup.env
    echo "${SCHEDULE} root /usr/local/bin/mariadb-backup > /proc/1/fd/1 2> /proc/self/fd/2" >> /etc/cron.d/mariadb-backup
    chmod 0644 /etc/cron.d/mariadb-backup
fi

exec "$@"
